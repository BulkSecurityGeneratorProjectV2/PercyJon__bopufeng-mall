<#include "/common/layout.html">
<@body>
<div class="wrapper">
    <section class="content">
      <form class="form-horizontal" method="post" action="/system/me/updateUser" id="infoFrom">
          <div class="box-body">
            	<input type="hidden" value="${(sysUser.id)!}" id="id" name="id">
            	<div class="form-group">
              		<label for="userName" class="col-sm-2 control-label">用户名</label>
              		<div class="col-sm-10">
                		<input type="text" name="userName" value="${(sysUser.userName)!}" class="form-control" readonly="readonly">
              		</div>
            	</div>
            	<input type="hidden" value="${(sysUser.userImg)!}" id="userImg" name="userImg">
            	<div class="form-group">
                	<label for="systemLogo" class="col-sm-2 control-label">头像</label>
                	<div class="col-sm-10">
						<div id="uploader-demo">
						    <div id="fileList" class="uploader-list"></div>
						    <button id="upload-container" type="button" class="btn btn-sm btn-primary">
								<i class="fa fa-cloud-download" aria-hidden="true"></i> 选择文件
							</button>
							<button id="upload-start" type="button" class="btn btn-sm btn-info">
								<i class="fa fa-cloud-download" aria-hidden="true"></i> 开始上传
							</button>
							<button id="filePicker" class="display-none">点击上传文件</button>
						</div>
                	</div>
              	</div>
              	<#if info??>
	            <div class="form-group">
	              	<div  class="alert alert-success alert-dismissible">
	          			<h4 style="margin-bottom: 0px;"><i class="fa fa-info"></i> ${info!}</h4>
        			</div>
            	</div>
            	</#if>
          </div>
        </form>
    </section>
</div>
</@body>

<script type="text/javascript">
	function submitHandler() {
		if ($("#infoFrom").validate().form()) {
			var formData = new FormData($("#infoFrom")[0]);
			$.ajax({
				url : $("#infoFrom").attr('action'),
				type : 'POST',
				data : formData,
				cache: false,
	            contentType: false,
	            processData: false,
	            dataType: 'json',
				beforeSend : function() {
					$.modal.loading("正在处理中，请稍后...");
					$.modal.disable();
				},
				success : function(data) {
					if (data.code == 200) {
						if (data.msg) {
							layer.msg(data.msg, {
								icon : 1
							});
						} else {
							layer.msg('修改成功', {
								icon : 1
							});
						}
						parent.layer.closeAll('iframe'); // 关闭当前frame
					} else {
						layer.msg(data.msg, {
							icon : 2
						});
						$.modal.closeLoading();
						$.modal.enable();
					}
				}
			});
		}
	}
</script>
